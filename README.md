# Aroma DB Client üìö

> –£–¥–æ–±–Ω—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (SQLAlchemy 2.0 style) —Å —Å–µ—Ä–≤–∏—Å-—Å–ª–æ–µ–º –∏ CLI –¥–ª—è —Ä–∞–±–æ—Ç—ã
> —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ **Aroma Platform**.  
> –ü–∞–∫–µ—Ç –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `pip install smeller_db`
> –∏ —Å—Ä–∞–∑—É –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∏–∑ Python-–∫–æ–¥–∞, —Ç–∞–∫ –∏ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∫–ª–∏–µ–Ω—Ç?](#–ø–æ—á–µ–º—É-—ç—Ç–æ—Ç-–∫–ª–∏–µ–Ω—Ç)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-sync)
5. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-async)
6. [CLI-—É—Ç–∏–ª–∏—Ç–∞ `aroma-db`](#cli-—É—Ç–∏–ª–∏—Ç–∞)
7. [API-—Å–ø—Ä–∞–≤–∫–∞](#api-—Å–ø—Ä–∞–≤–∫–∞)
8. [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ / –≤–∫–ª–∞–¥](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞--–≤–∫–ª–∞–¥)
9. [–õ–∏—Ü–µ–Ω–∑–∏—è](#license)

---

## –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –∫–ª–∏–µ–Ω—Ç?

* **–î–≤–∞ —Ä–µ–∂–∏–º–∞** ‚Äî —Å—Ä–∞–∑—É –≥–æ—Ç–æ–≤—ã `ORMClient` –∏ `AsyncORMClient`.
* **Pydantic v2** ‚Äî —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ ORM-–æ–±—ä–µ–∫—Ç–æ–≤ –≤ –¥–∞—Ç–∞–∫–ª–∞—Å—Å—ã –∏ –æ–±—Ä–∞—Ç–Ω–æ.
* **Rich & Typer** ‚Äî –∫—Ä–∞—Å–∏–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –º–æ—â–Ω—ã–π CLI ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
* **Zero-Boilerplate** ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–≤—å—é –ª—é–±–æ–π —Ç–∞–±–ª–∏—Ü—ã,
  –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ CLI –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º—ã.
* **–ü—Ä–∏–º–µ—Ä-—à–∞–±–ª–æ–Ω** (—Å–º. `tests/test.py`) ‚Äî –∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—á–∏–Ω–∞–π—Ç–µ.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ò–∑ PyPI
pip install smeller_db

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
git clone https://github.com/sensoryfox/smeller_db.git
cd smeller_db
pip install -e .[dev]   # + dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
Python ‚â• 3.9 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `typing.Annotated`, match-statement –∏ —Ç.–¥.).

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

`DatabaseConfig` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
(–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ `.env` —Ñ–∞–π–ª–µ). –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:

```
POSTGRES_HOST=185.180.230.207
POSTGRES_PORT=55432
POSTGRES_DB=sl_aroma
POSTGRES_USER=slreader
POSTGRES_PASSWORD=1qa2ws#ED
POSTGRES_OPTIONS=sslmode=disable  
DB_ASYNC=true
```

–î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ URL-—Å—Ç—Ä–æ–∫–∏ `postgresql://user:pass@host:port/dbname` ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ
`smeller_db/config/database.py`.

---
```py

from smeller_db.config.database import DatabaseConfig
from smeller_db.services.database_service import DatabaseService
db_config = DatabaseConfig.from_env()
db_service = DatabaseService(db_config, create_schema_on_init=False, drop_all_on_init=False)
# –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç—Ä–∏–¥–∂–µ–π
db_service.get_all_cartridges()

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (synchronous) <a name="–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-sync"></a>
# –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
from smeller_db.services import DatabaseService
from smeller_db.schemas.aroma_track import AromaTrackCreate
from smeller_db.schemas.channel_control_config import ChannelControlConfig, Color

service = DatabaseService.from_env()  # –∏—Å–ø–æ–ª—å–∑—É–µ—Ç .env

# 1) –°–æ–∑–¥–∞–¥–∏–º —Ç—Ä–µ–∫
track = service.create_aroma_track(
    AromaTrackCreate(
        name="Demo track",
        description="Just a couple of blocks üôÇ"
    )
)

# 2) –î–æ–±–∞–≤–∏–º –∞—Ä–æ–º–∞–±–ª–æ–∫
block = service.create_aromablock(
    AromaBlockCreate(
        name="Lime intro",
        description="Opening shot of fresh lime",
        data_type="image",
        content_link="s3://bucket/frames/lime.png",
        start_time=0.0,
        stop_time=3.0,
        aroma_track_id=track.id,
        channel_configurations={
            1: ChannelControlConfig(
                color=Color(r=0, g=255, b=0),
                intensity=0.7,
                interpolation="linear" # TODO MORE
            )
        }
    )
)

print(track)
print(block)

# 3) –ö—Ä–∞—Å–∏–≤–æ –ø–æ–∫–∞–∂–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î
service.print_database_overview()
```
---
```py
## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (asynchronous) <a name="–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-async"></a>
import asyncio
from smeller_db.services.database_service_async import AsyncDatabaseService
from smeller_db.schemas.aroma_track import AromaTrackCreate

async def main():
    service = AsyncDatabaseService.from_env()

    await service.setup_schema(create_schema=True)  # –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ alembic

    track = await service.create_aroma_track(
        AromaTrackCreate(name="Async track", description="Created asynchronously")
    )
    print(track)

asyncio.run(main())
```
---

## CLI-—É—Ç–∏–ª–∏—Ç–∞ <a name="cli-—É—Ç–∏–ª–∏—Ç–∞"></a>

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è (–¥–æ–ª–∂–Ω–∞) –∫–æ–º–∞–Ω–¥–∞ `aroma-db`.
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
aroma-db --help
–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–¥-–∫–æ–º–∞–Ω–¥—ã:
| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| ------------------------------------------- | --------------------------------------------------- |
| `smeller_db show-db` | –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (+3 —Å—Ç—Ä–æ–∫–∏ –ø—Ä–µ–≤—å—é). |
| `smeller_db show-db --headers` | –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü. |
| `smeller_db list-tables` | –°—É—Ö–æ–π —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü. |
| `smeller_db init-schema` | –°–æ–∑–¥–∞—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äì –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å) –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã. |
| `smeller_db init-schema --drop-first` | –£–¥–∞–ª–∏—Ç—å **–≤—Å—ë** –∏ –∑–∞–Ω–æ–≤–æ —Å–æ–∑–¥–∞—Ç—å. ‚ö† –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã! |
| `smeller_db ... --async` | –õ—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ async. |

–ü—Ä–∏–º–µ—Ä:
# –û–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

```bash
smeller_db show-db --rows 5
```

---

## API-—Å–ø—Ä–∞–≤–∫–∞

smeller_db/
‚îú‚îÄ async_orm_client.py        ‚Äì ¬´—Å—ã—Ä–æ–π¬ª AsyncSession-–æ–±—ë—Ä—Ç–∫–∞ (low-level)
‚îú‚îÄ orm_client.py              ‚Äì —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
‚îú‚îÄ services/
‚îÇ    ‚îú‚îÄ database_service.py   ‚Äì –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π sync-—Å–µ—Ä–≤–∏—Å
‚îÇ    ‚îî‚îÄ database_service_async.py ‚Äì async-—Å–µ—Ä–≤–∏—Å
‚îú‚îÄ models/                    ‚Äì ORM-—Ç–∞–±–ª–∏—Ü—ã SQLAlchemy
‚îî‚îÄ schemas/                   ‚Äì Pydantic-—Å—Ö–µ–º—ã (DTO)

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª–∞—Å—Å—ã/—Ñ—É–Ω–∫—Ü–∏–∏:

| –ö–ª–∞—Å—Å/—Ñ—É–Ω–∫—Ü–∏—è | –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| ---------------------------------------- | -------------------------------------- | ------------ |
| `ORMClient`, `AsyncORMClient` | `smeller_db/orm_client.py`, `smeller_db/async_orm_client.py` | Base-–∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è CRUD, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä |
| `DatabaseService`, `AsyncDatabaseService` | `smeller_db/services/‚Ä¶` | CRUD + —É–¥–æ–±–Ω—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã |
| `get_db_client()` | `smeller_db/db_client_factory.py` | –§–∞–±—Ä–∏–∫–∞ sync/async-–∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `smeller_db` (CLI) | `smeller_db/tools/db_cli.py` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ |

–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–¥–æ–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `pdoc`/`mkdocs` (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´docs¬ª).

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ / –≤–∫–ª–∞–¥

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2. `pip install -e .[dev]`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `pytest -q`.
4. –ü–µ—Ä–µ–¥ PR –∑–∞–ø—É—Å—Ç–∏—Ç–µ `black . && isort . && mypy smeller_db`.

–ë—É–¥–µ–º —Ä–∞–¥—ã pull-request'–∞–º üöÄ

---

## License

`smeller_db` —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ **MIT** ‚Äì –¥–µ–ª–∞–π—Ç–µ —Å –∫–æ–¥–æ–º, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ,
–Ω–æ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–ø–∏—é –ª–∏—Ü–µ–Ω–∑–∏–∏.
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

–ì–æ—Ç–æ–≤–æ!  
‚Ä¢ `pyproject.toml` ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `python -m build`,  
  –∑–∞—Ç–µ–º `twine upload dist/*` ‚Äî –ø–∞–∫–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.  
‚Ä¢ `README.md` ‚Äî –∫–ª–∞–¥—ë—Ç—Å—è —Ä—è–¥–æ–º; PyPI –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –µ–≥–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.  
